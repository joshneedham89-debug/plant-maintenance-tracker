<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plant Maintenance Tracker</title>

  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#1f7a3b">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="app">

    <!-- ---------------- DASHBOARD SCREEN ---------------- -->
    <section id="dashboardScreen" class="screen active">
      <h2 class="section-title">Dashboard</h2>

      <!-- Status bar -->
      <div class="stats-bar">
        <div class="stat-card">
          <div class="stat-label">OK</div>
          <div id="okCount" class="stat-value">0</div>
        </div>
        <div class="stat-card stat-due">
          <div class="stat-label">Due</div>
          <div id="dueCount" class="stat-value">0</div>
        </div>
        <div class="stat-card stat-over">
          <div class="stat-label">Overdue</div>
          <div id="overCount" class="stat-value">0</div>
        </div>

        <!-- GOLD UPDATE: PM Due Today -->
        <div class="stat-card stat-pm">
          <div class="stat-label">PM Due Today</div>
          <div id="pmDueTodayCount" class="stat-value">0</div>
        </div>
        <!-- END -->
      </div>

      <!-- Tons Update -->
      <div class="card">
        <h3>Update Tons</h3>
        <input id="currentTonsInput" type="number" placeholder="Enter tons run">
        <button id="updateTonsBtn" class="primary-btn full">Update Tons</button>
      </div>

      <!-- Problems quick actions -->
      <div class="card">
        <div class="problems-header-row">
          <h3>Problems</h3>
          <button id="openProblemPanelBtn" class="secondary-btn">+ Report</button>
        </div>
        <div class="part-meta">
          Open Problems: <b id="openProblemsCount">0</b>
        </div>
      </div>

      <!-- Tons History / Maintenance Export -->
      <div class="card">
        <h3>Tools</h3>
        <button id="exportMaintenanceBtn" class="secondary-btn full">Export Maintenance Log (CSV)</button>
      </div>
    </section>

    <!-- ---------------- MAINTENANCE SCREEN ---------------- -->
    <section id="maintenanceScreen" class="screen">
      <h2 class="section-title">Maintenance</h2>

      <div class="card maintenance-header">
        <label>Search Parts</label>
        <input id="searchPartsInput" type="text" placeholder="Search by name, category, or section">

        <label>Filter by Category</label>
        <select id="filterCategory"></select>

        <button id="addPartBtn" class="primary-btn full">+ Add Part</button>
      </div>

      <!-- Problems list -->
      <div class="card">
        <div class="problems-header-row">
          <h3>Problems</h3>
          <button id="openProblemPanelBtn2" class="secondary-btn">+ Report</button>
        </div>

        <div class="problem-filters">
          <button class="prob-filter active" data-filter="ALL">All</button>
          <button class="prob-filter" data-filter="Open">Open</button>
          <button class="prob-filter" data-filter="In Progress">In Progress</button>
          <button class="prob-filter" data-filter="Resolved">Resolved</button>
        </div>

        <div id="problemsList" class="problems-list"></div>
      </div>

      <!-- PMs moved to PMs tab (Phase 3.4 additive) -->

      <div id="partsList"></div>
    </section>

    <!-- ---------------- PM SCREEN (Phase 3.4) ---------------- -->
    <section id="pmScreen" class="screen">
      <h2 class="section-title">Preventive Maintenance</h2>

      <div class="card">
        <div class="problems-header-row">
          <h3>PMs</h3>
          <button id="openPmPanelBtn" class="secondary-btn">+ Add PM</button>
        </div>

        <div id="pmScreenDueToday" class="pm-due-count">PMs Due Today: <span id="pmDueTodayText">0</span></div>

        <div class="pm-filters">
          <button class="pm-filter active" data-pmfilter="DUE">Due Today</button>
          <button class="pm-filter" data-pmfilter="ALL">All</button>
          <button class="pm-filter" data-pmfilter="DONE">Completed</button>
        </div>

        <div id="pmsList" class="pms-list"></div>
      </div>
    </section>

    <!-- ---------------- INVENTORY SCREEN ---------------- -->
    <section id="inventoryScreen" class="screen">
      <h2 class="section-title">Inventory</h2>

      <div class="card">
        <label>Search Inventory</label>
        <input id="searchInventory" type="text" placeholder="Search inventory items">
      </div>

      <div id="inventoryList"></div>
    </section>

    <!-- ---------------- AC CALC SCREEN ---------------- -->
    <section id="acScreen" class="screen">
      <h2 class="section-title">AC Calculation</h2>

      <div class="card">
        <label>Oil Rate (gal/hr)</label>
        <input id="ac_oilRate" type="number" placeholder="ex: 15">

        <label>Pump Rate (gal/min)</label>
        <input id="ac_pumpRate" type="number" placeholder="ex: 2.5">

        <button id="ac_calcBtn" class="primary-btn full">Calculate</button>

        <div class="result">
          Total AC (gal): <b id="ac_totalAc">0</b>
        </div>
      </div>
    </section>

    <!-- ---------------- SETTINGS SCREEN ---------------- -->
    <section id="settingsScreen" class="screen">
      <h2 class="section-title">Settings</h2>

      <!-- Phase 3.4: Roles + Admin PIN (local only) -->
      <div class="card">
        <h3>Role (this device)</h3>
        <select id="roleSelect" class="select full">
          <option value="Ground">Ground</option>
          <option value="Maintenance">Maintenance</option>
          <option value="Supervisor">Supervisor</option>
          <option value="Admin">Admin</option>
        </select>

        <div class="row" style="margin-top:10px;">
          <button id="adminLoginBtn" class="secondary-btn full">Admin Login</button>
          <button id="adminLogoutBtn" class="ghost-btn full hidden">Admin Logout</button>
        </div>

        <div id="adminPanel" class="admin-panel hidden">
          <h4 class="subheading">Admin Controls</h4>

          <label>Change / Set Admin PIN</label>
          <input id="adminPinNew" type="password" inputmode="numeric" maxlength="8" placeholder="New PIN (4-8 digits)">
          <input id="adminPinConfirm" type="password" inputmode="numeric" maxlength="8" placeholder="Confirm New PIN">
          <button id="saveAdminPinBtn" class="primary-btn full">Save PIN</button>

          <label class="check-row" style="margin-top:10px;">
            <input type="checkbox" id="allowRoleChangeChk" checked>
            Allow role changes on this device without PIN
          </label>
          <div class="hint">Tip: Turn this off after you set the role on each phone.</div>
        </div>
      </div>

      <div class="card">
        <button id="exportBtn" class="primary-btn full">Export Data</button>
        <!-- GOLD UPDATE: Supervisor PM compliance export -->
        <button id="exportPmComplianceBtn" class="secondary-btn full">Export PM Compliance (CSV)</button>
        <!-- END -->
        <button id="resetAllBtn" class="danger-btn full">Reset Entire App</button>
      </div>
    </section>

    <!-- ---------------- BOTTOM NAV ---------------- -->
    <nav class="bottom-nav">
      <button class="nav-btn active" data-screen="dashboardScreen">üè†<br>Home</button>
      <button class="nav-btn" data-screen="maintenanceScreen">üõ†Ô∏è<br>Maint</button>
      <button class="nav-btn" data-screen="pmScreen">‚úÖ<br>PMs</button>
      <button class="nav-btn" data-screen="inventoryScreen">üì¶<br>Inventory</button>
      <button class="nav-btn" data-screen="acScreen">üìä<br>AC Calc</button>
      <button class="nav-btn" data-screen="settingsScreen">‚öôÔ∏è<br>Settings</button>
    </nav>

  </div>

  <!-- ADD / EDIT PART PANEL -->
  <div id="partPanelOverlay" class="panel-overlay hidden">
    <div id="addPartPanel" class="slide-panel">
      <div class="slide-panel-header">
        <h3 id="partPanelTitle">Add New Part</h3>
        <button id="closePartPanel" class="close-btn">‚úñ</button>
      </div>

      <div class="slide-panel-body">

        <label>Part Name</label>
        <input id="newPartName" type="text" list="inventoryPartNames" placeholder="Part name">
        <datalist id="inventoryPartNames"></datalist>

        <label>Category</label>
        <select id="newPartCategory"></select>

        <label>Section</label>
        <input id="newPartSection" type="text" placeholder="ex: Drum / Baghouse / Drag">

        <label>Min Qty</label>
        <input id="newPartMinQty" type="number" placeholder="ex: 2">

        <label>Current Qty</label>
        <input id="newPartQty" type="number" placeholder="ex: 5">

        <label>Notes</label>
        <input id="newPartNotes" type="text" placeholder="Optional notes">

        <h4 class="subheading">Photos (optional)</h4>
        <button id="addPhotoBtn" class="secondary-btn full">+ Add Photo</button>
        <input id="photoInput" type="file" accept="image/*" multiple class="file-input-hidden">
        <div id="photoPreview" class="photo-preview"></div>

        <div class="panel-footer">
          <button id="savePartBtn" class="primary-btn full">Save</button>
        </div>

      </div>
    </div>
  </div>

  <!-- PROBLEM PANEL -->
  <div id="problemPanelOverlay" class="panel-overlay hidden">
    <div id="problemPanel" class="slide-panel">
      <div class="slide-panel-header">
        <h3 id="problemPanelTitle">Report Problem</h3>
        <button id="closeProblemPanel" class="close-btn">‚úñ</button>
      </div>

      <div class="slide-panel-body">
        <label>Title</label>
        <input id="problemTitle" type="text" placeholder="ex: Drag chain squealing">

        <label>Area</label>
        <select id="problemArea"></select>

        <label>Status</label>
        <select id="problemStatus">
          <option value="Open">Open</option>
          <option value="In Progress">In Progress</option>
          <option value="Resolved">Resolved</option>
        </select>

        <label>Notes</label>
        <input id="problemNotes" type="text" placeholder="Optional notes">

        <h4 class="subheading">Photos (optional)</h4>
        <button id="probAddPhotoBtn" class="secondary-btn full">+ Add Photo</button>
        <input id="probPhotoInput" type="file" accept="image/*" multiple class="file-input-hidden">
        <div id="probPhotoPreview" class="photo-preview"></div>

        <div class="panel-footer">
          <button id="saveProblemBtn" class="primary-btn full">Save Problem</button>
        </div>

        <div class="panel-footer">
          <button id="deleteProblemBtn" class="danger-btn full hidden">Delete Problem</button>
        </div>
      </div>
    </div>
  </div>

  <!-- PM ADD/EDIT PANEL -->
  <div id="pmPanelOverlay" class="panel-overlay hidden">
    <div id="pmPanel" class="slide-panel">
      <div class="slide-panel-header">
        <h3 id="pmPanelTitle">Add PM</h3>
        <button id="closePmPanel" class="close-btn">‚úñ</button>
      </div>

      <div class="slide-panel-body">
        <label>PM Name</label>
        <input id="pmName" type="text" placeholder="ex: Grease bearings">

        <label>Area</label>
        <select id="pmArea"></select>

        <label>Frequency</label>
        <select id="pmFrequency">
          <option value="Daily">Daily</option>
          <option value="Weekly">Weekly</option>
        </select>

        <label>Checklist (optional)</label>
        <textarea id="pmChecklistDef" class="textarea" rows="4" placeholder="One checklist item per line"></textarea>

        <h4 class="subheading">Visibility (who can see this PM)</h4>
        <div class="role-grid">
          <label class="check-row"><input type="checkbox" id="pmVisAdmin" checked> Admin</label>
          <label class="check-row"><input type="checkbox" id="pmVisSupervisor" checked> Supervisor</label>
          <label class="check-row"><input type="checkbox" id="pmVisMaintenance" checked> Maintenance</label>
          <label class="check-row"><input type="checkbox" id="pmVisGround" checked> Ground</label>
        </div>

        <label class="check-row"><input type="checkbox" id="pmDefLocked"> Lock PM definition (prevents edits)</label>

        <div class="panel-footer">
          <button id="savePmBtn" class="primary-btn full">Save PM</button>
        </div>
      </div>
    </div>
  </div>

  <!-- PM COMPLETE PANEL -->
  <div id="pmCompleteOverlay" class="panel-overlay hidden">
    <div id="pmCompletePanel" class="slide-panel">
      <div class="slide-panel-header">
        <h3 id="pmCompleteTitle">Complete PM</h3>
        <button id="closePmComplete" class="close-btn">‚úñ</button>
      </div>

      <div class="slide-panel-body">
        <label>Completion Date</label>
        <input id="pmCompDate" type="date">

        <label>Notes</label>
        <input id="pmCompNotes" type="text" placeholder="Optional notes">

        <div id="pmChecklistWrap" class="pm-checklist-wrap hidden">
          <h4 class="subheading">Checklist</h4>
          <div id="pmChecklistList" class="pm-checklist-list"></div>
          <div id="pmChecklistHint" class="hint"></div>
        </div>

        <h4 class="subheading">Photos (optional)</h4>
        <button id="pmAddPhotoBtn" class="secondary-btn full">+ Add Photo</button>
        <input id="pmPhotoInput" type="file" accept="image/*" multiple class="file-input-hidden">
        <div id="pmPhotoPreview" class="photo-preview"></div>

        <div class="panel-footer">
          <button id="savePmCompletionBtn" class="primary-btn full">Complete PM</button>
        </div>
      </div>
    </div>
  </div>

  <!-- PM GALLERY -->
  <div id="pmGalleryOverlay" class="panel-overlay hidden">
    <div id="pmGalleryPanel" class="slide-panel">
      <div class="slide-panel-header">
        <h3 id="pmGalleryTitle">PM Photos</h3>
        <button id="closePmGallery" class="close-btn">‚úñ</button>
      </div>

      <div class="slide-panel-body">
        <div id="pmGalleryMeta" class="part-meta"></div>
        <div id="pmGalleryGrid" class="photo-preview"></div>
      </div>
    </div>
  </div>
  <!-- END PM GALLERY -->

  <!-- LIGHTBOX -->
  <div id="lightboxOverlay" class="lightbox hidden">
    <img id="lightboxImg" src="" alt="Photo">
  </div>

  <!-- ADMIN PIN PROMPT (Phase 3.4) -->
  <div id="adminPinOverlay" class="panel-overlay hidden">
    <div id="adminPinPanel" class="slide-panel">
      <div class="slide-panel-header">
        <h3>Admin PIN</h3>
        <button id="closeAdminPin" class="close-btn">‚úñ</button>
      </div>
      <div class="slide-panel-body">
        <label>Enter PIN</label>
        <input id="adminPinInput" type="password" inputmode="numeric" maxlength="8" placeholder="4-8 digits">
        <div id="adminPinMsg" class="hint"></div>
        <div class="panel-footer">
          <button id="submitAdminPinBtn" class="primary-btn full">Unlock Admin</button>
        </div>
      </div>
    </div>
  </div>

  <script src="inventory.js"></script>
  <script src="script.js"></script>
</body>
</html>
